@if (credential(); as c) {
  <!-- Plantilla PDF oculta - usada solo para generar el documento -->
  <div class="pdf-template-wrapper" #pdfTemplate>
    <app-credential-view-pdf
      [data]="pdfData()"
      [photoUrl]="photoUrl()"
      [qrUrl]="qrUrl()"
      [showPhotoPlaceholder]="!c.persona.fotoUrl"
    />
  </div>

  <div class="id-page">
    <!-- Back / header -->
    <div class="id-top">
      <button class="id-back" type="button" aria-label="Volver" (click)="goBack()">
        <span class="id-back-ico">←</span>
        <span>Volver</span>
      </button>
    </div>

    <header class="id-head">
      <h1 class="id-title">{{ c.doc.titulo }}</h1>
      <p class="id-subtitle">{{ c.doc.subtitulo }}</p>
    </header>

    <!-- ============ DESKTOP / TABLET CARD (LANDSCAPE) ============ -->
    <section class="id-shell id-shell--desktop" aria-label="Credencial digital - escritorio">
      <article class="id-card" #credentialCardDesktop>
        <!-- Header con org + doc -->
        <div class="id-header-blue">
          <div class="id-header-brand">
            <div class="id-header-emblem id-hologram" aria-hidden="true">
              <img [src]="logoUrl()" [alt]="c.org.nombre" />
            </div>
            <div class="id-header-text">
              <div class="id-header-title">{{ c.org.nombre }}</div>
              <div class="id-header-sub">{{ c.org.pais }} – {{ c.org.dependencia }}</div>
            </div>
          </div>
          <div class="id-header-right">
            <div class="id-header-id">{{ c.doc.numeroOficial }}</div>
            @if (c.verificacion.verificado) {
              <span class="id-header-verified">VERIFICADO</span>
            }
          </div>
        </div>

        <!-- Cuerpo tarjeta blanca -->
        <div class="id-card-body">
          <div class="id-main">
            <!-- Columna izquierda: foto + estado -->
            <aside class="id-photo">
              <div class="photo-frame">
                @if (c.persona.fotoUrl) {
                  <img [src]="photoUrl()" [alt]="c.persona.nombreCompleto" />
                } @else {
                  <div class="photo-placeholder">FOTO</div>
                }
              </div>
              <div class="pill" [class.pill--active]="c.militar.estado === 'ACTIVO'" [class.pill--warn]="c.militar.estado === 'PENDIENTE'" [class.pill--off]="c.militar.estado === 'INACTIVO'">{{ c.militar.estado }}</div>
            </aside>

            <!-- Columna central: datos personales y militares -->
            <section class="id-info">
              <div class="id-block">
                <div class="label">NOMBRE COMPLETO</div>
                <div class="value value--xl">{{ c.persona.nombreCompleto }}</div>
              </div>
              <div class="kv">
                <div class="k">RANGO</div>
                <div class="v">{{ c.militar.rango }}</div>
              </div>
              <div class="kv">
                <div class="k">UNIDAD</div>
                <div class="v">{{ c.militar.unidad }}</div>
              </div>
              <div class="kv">
                <div class="k">FECHA DE NACIMIENTO</div>
                <div class="v">{{ c.persona.fechaNacimiento }}</div>
              </div>
              <div class="kv">
                <div class="k">FECHA DE INGRESO</div>
                <div class="v">{{ c.militar.fechaIngreso }}</div>
              </div>
              @if (c.militar.aniosServicio != null) {
                <div class="kv">
                  <div class="k">AÑOS DE SERVICIO</div>
                  <div class="v">{{ c.militar.aniosServicio }}</div>
                </div>
              }
              <div class="kv kv--wide">
                <div class="k">CORREO INSTITUCIONAL</div>
                <div class="v">{{ c.contacto.correo }}</div>
              </div>
            </section>

            <!-- Columna derecha: QR con holograma -->
            <aside class="id-qr">
              <div class="qr-wrap">
                <div class="qr-frame id-hologram" aria-label="Código QR de verificación">
                  <img [src]="qrUrl()" alt="QR verificación" />
                </div>
                <div class="qr-caption">CÓDIGO DE VERIFICACIÓN</div>
                <div class="id-hash">
                  <span class="k">SHA256:</span>
                  <span class="v">{{ c.verificacion.sha256 }}</span>
                </div>
              </div>
            </aside>
          </div>

          <!-- Pie de tarjeta -->
          <div class="id-card-footer">
            Emisión: {{ c.vigencia.emision }} • Válido hasta: {{ c.vigencia.validoHasta }}
          </div>
        </div>
      </article>

      <!-- Botones de acción -->
      <div class="id-actions">
        <button class="btn btn--primary" type="button" (click)="onDownloadPdf()">
          <mat-icon>download</mat-icon>
          Descargar PDF
        </button>
        <button class="btn btn--outline" type="button" (click)="onShare()">
          <mat-icon>share</mat-icon>
          Compartir Credencial
        </button>
        <button class="btn btn--ghost" type="button" (click)="onSendToMobile()">
          <mat-icon>phonelink</mat-icon>
          Ver en móvil
        </button>
      </div>
    </section>

    <!-- ============ MOBILE CARD (PORTRAIT) ============ -->
    <section class="id-shell id-shell--mobile" aria-label="Credencial digital - móvil">
      <article class="m-card" #credentialCardMobile>
        <div class="m-topbar">
          <div class="m-brand">
            <div class="m-emblem id-hologram" aria-hidden="true">
              <img class="m-brand-ico" [src]="logoUrl()" [alt]="c.org.nombre" />
            </div>
            <div class="m-brand-text">
              <div class="m-brand-title">{{ c.org.nombre }}</div>
              <div class="m-brand-sub">{{ c.org.dependencia }}</div>
            </div>
          </div>
        </div>

        <div class="m-content">
          <div class="m-photo">
            <img [src]="photoUrl()" [alt]="c.persona.nombreCompleto" />
            <div class="pill pill--float" [class.pill--active]="c.militar.estado === 'ACTIVO'" [class.pill--warn]="c.militar.estado === 'PENDIENTE'" [class.pill--off]="c.militar.estado === 'INACTIVO'">{{ c.militar.estado }}</div>
          </div>

          <div class="m-name">{{ c.persona.nombreCompleto }}</div>
          <div class="m-rank">{{ c.militar.rango }}</div>
          <div class="m-id">{{ c.persona.identificacion }}</div>

          <div class="m-details">
            <div class="m-detail-row">
              <span class="m-detail-label">Unidad</span>
              <span class="m-detail-value">{{ c.militar.unidad }}</span>
            </div>
            <div class="m-detail-row">
              <span class="m-detail-label">Emisión</span>
              <span class="m-detail-value">{{ c.vigencia.emision }}</span>
            </div>
            <div class="m-detail-row">
              <span class="m-detail-label">Válido hasta</span>
              <span class="m-detail-value">{{ c.vigencia.validoHasta }}</span>
            </div>
            <div class="m-detail-row m-detail-row--last">
              <span class="m-detail-label">Correo institucional</span>
              <span class="m-detail-value">{{ c.contacto.correo }}</span>
            </div>
          </div>

          <div class="m-qr">
            <div class="qr-frame id-hologram">
              <img [src]="qrUrlMobile()" alt="QR verificación" />
            </div>
            <div class="qr-caption">CÓDIGO DE VERIFICACIÓN</div>
          </div>

          <div class="m-actions">
            <button class="btn btn--primary btn--full" type="button" (click)="onDownloadPdf()">
              <span class="btn-ico">⬇</span>
              Descargar PDF
            </button>
            <button class="btn btn--soft btn--full" type="button" (click)="onShare()">
              <span class="btn-ico">⤴</span>
              Compartir Credencial
            </button>
          </div>

          <div class="m-hash">
            <span class="k">SHA256:</span>
            <span class="v">{{ c.verificacion.sha256 }}</span>
          </div>
        </div>
      </article>
    </section>
  </div>
} @else {
  <!-- Fallback: credencial no disponible -->
  <div class="id-page">
    <div class="id-top">
      <button class="id-back" type="button" aria-label="Volver" (click)="goBack()">
        <span class="id-back-ico">←</span>
        <span>Volver</span>
      </button>
    </div>
    <header class="id-head">
      <h1 class="id-title">Credencial no disponible</h1>
      <p class="id-subtitle">Acceda desde la lista de personal registrado para visualizar la credencial</p>
    </header>
  </div>
}
